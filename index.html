<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KING Poetry & Story Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        :root {
            --primary: #6C63FF;
            --secondary: #FF6584;
            --accent: #36D1DC;
            --light: #f8f9fa;
            --dark: #121826;
            --glass-light: rgba(255, 255, 255, 0.3);
            --glass-dark: rgba(18, 24, 38, 0.7);
            --text-light: #333;
            --text-dark: #f8f9fa;
            --card-light: rgba(255, 255, 255, 0.8);
            --card-dark: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body.light-mode {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-light) !important;
        }

        body.light-mode * {
            color: var(--text-light) !important;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: var(--text-dark) !important;
        }

        body.dark-mode * {
            color: var(--text-dark) !important;
        }

        /* Fix light mode text visibility */
        body.light-mode .card-content h3,
        body.light-mode .card-content p,
        body.light-mode .user-info,
        body.light-mode .coin-display,
        body.light-mode .detail-header h1,
        body.light-mode .detail-header p,
        body.light-mode .detail-content,
        body.light-mode .item-title,
        body.light-mode .item-author,
        body.light-mode .item-preview,
        body.light-mode .search-bar input,
        body.light-mode .back-btn,
        body.light-mode .upload-form,
        body.light-mode .upload-header h3,
        body.light-mode .upload-header p,
        body.light-mode .form-group input,
        body.light-mode .form-group textarea,
        body.light-mode .profile-card,
        body.light-mode .profile-info h3,
        body.light-mode .profile-info p,
        body.light-mode .stat-item,
        body.light-mode .my-item-title,
        body.light-mode .notification {
            color: var(--text-light) !important;
        }

        /* Fix light mode input placeholders */
        body.light-mode .form-group input::placeholder,
        body.light-mode .form-group textarea::placeholder,
        body.light-mode .search-bar input::placeholder {
            color: rgba(51, 51, 51, 0.7) !important;
        }

        .bubbles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .bubble {
            position: absolute;
            bottom: -100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: rise 15s infinite ease-in;
        }

        @keyframes rise {
            0% {
                bottom: -100px;
                transform: translateX(0);
            }
            50% {
                transform: translateX(100px);
            }
            100% {
                bottom: 110%;
                transform: translateX(-100px);
            }
        }

        /* Glass Card Style */
        .glass-card {
            width: 240px;
            height: 360px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(29px);
            -webkit-backdrop-filter: blur(29px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(255, 255, 255, 0.1),
                inset 0 0 16px 8px rgba(255, 255, 255, 0.8);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .glass-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.8),
                transparent
            );
        }

        .glass-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(
                180deg,
                rgba(255, 255, 255, 0.8),
                transparent,
                rgba(255, 255, 255, 0.3)
            );
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .theme-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .theme-btn:hover {
            transform: rotate(30deg);
            background: rgba(255, 255, 255, 0.3);
        }

        body.light-mode .theme-btn {
            color: var(--text-light);
        }

        /* KING Logo Animation */
        .king-logo {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            animation: fadeOut 2s ease-in-out 2s forwards;
        }

        .king-text {
            font-family: 'Dancing Script', cursive;
            font-size: 8rem;
            background: linear-gradient(45deg, #FF6584, #6C63FF, #36D1DC);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px rgba(108, 99, 255, 0.5); }
            to { text-shadow: 0 0 20px rgba(255, 101, 132, 0.8), 0 0 30px rgba(54, 209, 220, 0.6); }
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }

        /* Auth Container */
        .auth-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1500;
            align-items: center;
            justify-content: center;
        }

        .auth-box {
            width: 400px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        body.light-mode .auth-header {
            color: var(--text-light);
        }

        .auth-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            color: white;
            font-weight: 500;
            transition: all 0.3s;
        }

        body.light-mode .auth-tab {
            color: var(--text-light);
        }

        .auth-tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary) !important;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            outline: none;
            transition: border 0.3s;
        }

        body.light-mode .form-group input {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        .form-group input:focus {
            border-color: var(--primary);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .auth-btn:hover {
            transform: translateY(-3px);
        }

        .google-btn {
            background: white;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .google-btn i {
            color: #DB4437;
            font-size: 1.2rem;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin-bottom: 40px;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        body.light-mode .user-info {
            color: var(--text-light);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white !important;
        }

        .coin-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        body.light-mode .coin-display {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
        }

        .coin-display i {
            color: gold;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Logout Button */
        .logout-btn {
            background: rgba(255, 101, 132, 0.2);
            border: 1px solid rgba(255, 101, 132, 0.5);
            color: white;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }

        body.light-mode .logout-btn {
            background: rgba(255, 101, 132, 0.1);
            color: var(--text-light);
            border: 1px solid rgba(255, 101, 132, 0.3);
        }

        .logout-btn:hover {
            background: rgba(255, 101, 132, 0.3);
        }

        body.light-mode .logout-btn:hover {
            background: rgba(255, 101, 132, 0.2);
        }

        .selection-container {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin-top: 50px;
        }

        .selection-card {
            position: relative;
        }

        .card-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 20px;
        }

        body.light-mode .card-content {
            color: var(--text-light);
        }

        .card-content h3 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-family: 'Dancing Script', cursive;
        }

        .card-content p {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Poem List */
        .poem-list-container, .novel-list-container {
            display: none;
            padding: 20px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            transition: background 0.3s;
        }

        body.light-mode .back-btn {
            background: rgba(0, 0, 0, 0.1);
            color: var(--text-light);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        body.light-mode .back-btn:hover {
            background: rgba(0, 0, 0, 0.2);
        }

        .search-bar {
            width: 100%;
            max-width: 500px;
            margin: 0 auto 30px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            outline: none;
        }

        body.light-mode .search-bar input {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        .search-bar i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 1.2rem;
        }

        body.light-mode .search-bar i {
            color: var(--text-light);
        }

        .poems-grid, .novels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            padding: 20px;
        }

        .poem-item, .novel-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.light-mode .poem-item,
        body.light-mode .novel-item {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .poem-item:hover, .novel-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        body.light-mode .poem-item:hover,
        body.light-mode .novel-item:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .item-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .item-title {
            font-size: 1.3rem;
            color: white;
            margin-bottom: 10px;
        }

        body.light-mode .item-title {
            color: var(--text-light);
        }

        .item-author {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        body.light-mode .item-author {
            color: rgba(0, 0, 0, 0.7);
        }

        .item-preview {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        body.light-mode .item-preview {
            color: rgba(0, 0, 0, 0.8);
        }

        /* Like Button */
        .like-section {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }

        .like-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        body.light-mode .like-btn {
            color: rgba(0, 0, 0, 0.7);
        }

        .like-btn.liked {
            color: #ff4757;
        }

        .like-btn:hover {
            color: #ff4757;
        }

        body.light-mode .like-btn:hover {
            color: #ff4757;
        }

        .like-count {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        body.light-mode .like-count {
            color: rgba(0, 0, 0, 0.8);
        }

        /* Poem Detail */
        .poem-detail-container, .novel-detail-container {
            display: none;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        .detail-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        body.light-mode .detail-header {
            color: var(--text-light);
        }

        .detail-header .like-section {
            justify-content: center;
            margin-top: 15px;
        }

        .detail-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .detail-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            color: white;
            line-height: 1.8;
            font-size: 1.1rem;
        }

        body.light-mode .detail-content {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
        }

        /* Upload Container */
        .upload-container {
            display: none;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        .upload-form {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            color: white;
        }

        body.light-mode .upload-form {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
        }

        .upload-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .upload-header .user-avatar {
            width: 40px;
            height: 40px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }

        body.light-mode .upload-area {
            border: 2px dashed rgba(0, 0, 0, 0.3);
        }

        .upload-area:hover {
            border-color: var(--primary);
        }

        .upload-area i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.5);
        }

        body.light-mode .upload-area i {
            color: rgba(0, 0, 0, 0.5);
        }

        .image-preview {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            resize: vertical;
            outline: none;
        }

        body.light-mode textarea {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        .upload-btn {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px auto 0;
            transition: transform 0.3s;
        }

        .upload-btn:hover {
            transform: translateY(-3px);
        }

        .coin-cost {
            text-align: center;
            color: gold;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        /* Floating Add Button */
        .floating-add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(108, 99, 255, 0.5);
            z-index: 100;
            transition: transform 0.3s;
        }

        .floating-add-btn:hover {
            transform: scale(1.1);
        }

        /* Profile Container */
        .profile-container {
            display: none;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            color: white;
            margin-bottom: 30px;
        }

        body.light-mode .profile-card {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white !important;
        }

        .profile-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .profile-info p {
            color: rgba(255, 255, 255, 0.7);
        }

        body.light-mode .profile-info p {
            color: rgba(0, 0, 0, 0.7);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
        }

        body.light-mode .stat-item {
            background: rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .my-poems, .my-novels {
            margin-top: 30px;
        }

        .my-poems h4, .my-novels h4 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .my-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .my-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.light-mode .my-item {
            background: rgba(0, 0, 0, 0.05);
        }

        .my-item-title {
            font-weight: 500;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.1rem;
            transition: color 0.3s;
        }

        body.light-mode .action-btn {
            color: rgba(0, 0, 0, 0.7);
        }

        .action-btn:hover {
            color: white;
        }

        body.light-mode .action-btn:hover {
            color: black;
        }

        .edit-btn:hover {
            color: var(--accent);
        }

        body.light-mode .edit-btn:hover {
            color: var(--accent);
        }

        .delete-btn:hover {
            color: var(--secondary);
        }

        body.light-mode .delete-btn:hover {
            color: var(--secondary);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 10px;
            padding: 15px 25px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 2000;
            transform: translateX(150%);
            transition: transform 0.5s;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        body.light-mode .notification {
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-light);
            border: 1px solid rgba(0, 0, 0, 0.3);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            font-size: 1.5rem;
        }

        .notification.success i {
            color: #4CAF50;
        }

        .notification.error i {
            color: #f44336;
        }

        .notification.info i {
            color: #2196F3;
        }

        /* Admin Message */
        .admin-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            color: white;
            z-index: 2000;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.3s;
        }

        body.light-mode .admin-message {
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-light);
            border: 1px solid rgba(0, 0, 0, 0.3);
        }

        .admin-message.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .admin-message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .admin-message-header h3 {
            font-size: 1.5rem;
        }

        .close-message {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        body.light-mode .close-message {
            color: var(--text-light);
        }

        .admin-message-content img {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin: 15px 0;
        }

        /* Admin Access Button */
        .admin-access-btn {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
            z-index: 100;
            transition: transform 0.3s;
        }

        .admin-access-btn:hover {
            transform: scale(1.1);
        }

        /* Admin Container */
        .admin-container {
            display: none;
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.light-mode .admin-panel {
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-light);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .admin-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .admin-header h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #FFD700;
        }

        body.light-mode .admin-header h2 {
            color: #DAA520;
        }

        /* Admin Tabs */
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }

        body.light-mode .admin-tabs {
            border-bottom: 2px solid rgba(0, 0, 0, 0.2);
        }

        .admin-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .admin-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .admin-tab:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .admin-tab.active {
            background: rgba(108, 99, 255, 0.3);
            border: 1px solid rgba(108, 99, 255, 0.5);
        }

        body.light-mode .admin-tab.active {
            background: rgba(108, 99, 255, 0.2);
            border: 1px solid var(--primary);
        }

        /* Admin Tab Content */
        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        /* Users List */
        .users-list {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .user-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.3s;
        }

        body.light-mode .user-item {
            background: rgba(0, 0, 0, 0.05);
        }

        .user-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .user-item:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white !important;
        }

        .user-details h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .user-details p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .user-coins {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 215, 0, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
        }

        body.light-mode .user-coins {
            background: rgba(255, 215, 0, 0.3);
        }

        .user-coins i {
            color: gold;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .user-action-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        body.light-mode .user-action-btn {
            color: rgba(0, 0, 0, 0.7);
        }

        .user-action-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }

        body.light-mode .user-action-btn:hover {
            color: black;
            background: rgba(0, 0, 0, 0.1);
        }

        /* Coin Management */
        .coin-management h3 {
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .coin-action-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        body.light-mode .coin-action-form {
            background: rgba(0, 0, 0, 0.05);
        }

        .coin-action-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .user-select {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            outline: none;
        }

        body.light-mode .user-select {
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-light);
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        .coin-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .coin-btn {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            border: none;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.3s;
        }

        .coin-btn:hover {
            transform: translateY(-3px);
        }

        .add-coins {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
        }

        .remove-coins {
            background: linear-gradient(45deg, #f44336, #FF9800);
        }

        .set-coins {
            background: linear-gradient(45deg, #2196F3, #03A9F4);
        }

        /* Transaction History */
        .transaction-history {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }

        body.light-mode .transaction-history {
            background: rgba(0, 0, 0, 0.05);
        }

        .transaction-history h4 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .transaction-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }

        body.light-mode .transaction-item {
            background: rgba(0, 0, 0, 0.05);
        }

        .transaction-item.added {
            border-left-color: #4CAF50;
        }

        .transaction-item.removed {
            border-left-color: #f44336;
        }

        .transaction-item.set {
            border-left-color: #2196F3;
        }

        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .transaction-amount.added {
            color: #4CAF50;
        }

        .transaction-amount.removed {
            color: #f44336;
        }

        .transaction-amount.set {
            color: #2196F3;
        }

        .transaction-details {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Message Form */
        .message-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }

        body.light-mode .message-form {
            background: rgba(0, 0, 0, 0.05);
        }

        .message-image-upload {
            margin-bottom: 20px;
        }

        .send-message-btn {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.3s;
        }

        .send-message-btn:hover {
            transform: translateY(-3px);
        }

        /* Statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s;
        }

        body.light-mode .stat-card {
            background: rgba(0, 0, 0, 0.05);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .recent-activity {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }

        body.light-mode .recent-activity {
            background: rgba(0, 0, 0, 0.05);
        }

        .activity-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        body.light-mode .activity-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(108, 99, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .activity-content {
            flex: 1;
        }

        .activity-user {
            font-weight: 500;
        }

        .activity-time {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .selection-container {
                flex-direction: column;
                align-items: center;
                gap: 30px;
            }
            
            .glass-card {
                width: 280px;
                height: 400px;
            }
            
            .auth-box {
                width: 90%;
                padding: 30px 20px;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .admin-tabs {
                flex-direction: column;
            }
            
            .coin-actions {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <!-- Bubbles Animation -->
    <div class="bubbles-container" id="bubbles"></div>

    <!-- KING Logo Animation -->
    <div class="king-logo" id="kingLogo">
        <div class="king-text">KING</div>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-btn" id="themeToggle">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-header">
                <h2>Welcome to KING's Realm</h2>
                <p>Create and share your poetry & stories</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="signup">Sign Up</div>
            </div>
            
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" placeholder="Password" required>
                </div>
                <button type="submit" class="auth-btn">Login</button>
            </form>
            
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <input type="text" id="signupName" placeholder="Full Name" required>
                </div>
                <div class="form-group">
                    <input type="email" id="signupEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="signupPassword" placeholder="Password" required>
                </div>
                <div class="form-group">
                    <input type="text" id="signupNickname" placeholder="Nickname (Display Name)" required>
                </div>
                <button type="submit" class="auth-btn">Sign Up</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="header">
            <div class="user-section">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <h3 id="userName">User</h3>
                        <p id="userEmail">user@example.com</p>
                    </div>
                </div>
                <div class="coin-display">
                    <i class="fas fa-coins"></i>
                    <span id="userCoins">150</span> Coins
                </div>
            </div>
            
            <div class="user-actions">
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <div class="selection-container">
            <div class="selection-card">
                <div class="glass-card"></div>
                <div class="card-content" id="poemSelection">
                    <h3>Poems</h3>
                    <p>Write and share your beautiful poetry</p>
                    <p><i class="fas fa-arrow-right"></i> Click to explore</p>
                </div>
            </div>
            
            <div class="selection-card">
                <div class="glass-card"></div>
                <div class="card-content" id="novelSelection">
                    <h3>Novels</h3>
                    <p>Create and read captivating stories</p>
                    <p><i class="fas fa-arrow-right"></i> Click to explore</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Poem List -->
    <div class="poem-list-container" id="poemListContainer">
        <button class="back-btn" id="backFromPoemList">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </button>
        
        <div class="search-bar">
            <input type="text" id="poemSearch" placeholder="Search poems by title or author...">
            <i class="fas fa-search"></i>
        </div>
        
        <div class="poems-grid" id="poemsGrid">
            <!-- Poems will be loaded here -->
        </div>
    </div>

    <!-- Novel List -->
    <div class="novel-list-container" id="novelListContainer">
        <button class="back-btn" id="backFromNovelList">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </button>
        
        <div class="search-bar">
            <input type="text" id="novelSearch" placeholder="Search novels by title or author...">
            <i class="fas fa-search"></i>
        </div>
        
        <div class="novels-grid" id="novelsGrid">
            <!-- Novels will be loaded here -->
        </div>
    </div>

    <!-- Poem Detail -->
    <div class="poem-detail-container" id="poemDetailContainer">
        <button class="back-btn" id="backFromPoemDetail">
            <i class="fas fa-arrow-left"></i> Back to Poems
        </button>
        
        <div class="detail-header">
            <h1 id="poemDetailTitle">Poem Title</h1>
            <p id="poemDetailAuthor">By Author</p>
            <div class="like-section">
                <button class="like-btn" id="poemDetailLikeBtn">
                    <i class="fas fa-heart"></i>
                </button>
                <span class="like-count" id="poemDetailLikeCount">0</span>
            </div>
        </div>
        
        <img id="poemDetailImage" src="" alt="Poem Image" class="detail-image">
        
        <div class="detail-content" id="poemDetailContent">
            <!-- Poem content will be loaded here -->
        </div>
    </div>

    <!-- Novel Detail -->
    <div class="novel-detail-container" id="novelDetailContainer">
        <button class="back-btn" id="backFromNovelDetail">
            <i class="fas fa-arrow-left"></i> Back to Novels
        </button>
        
        <div class="detail-header">
            <h1 id="novelDetailTitle">Novel Title</h1>
            <p id="novelDetailAuthor">By Author</p>
            <div class="like-section">
                <button class="like-btn" id="novelDetailLikeBtn">
                    <i class="fas fa-heart"></i>
                </button>
                <span class="like-count" id="novelDetailLikeCount">0</span>
            </div>
        </div>
        
        <img id="novelDetailImage" src="" alt="Novel Image" class="detail-image">
        
        <div class="detail-content" id="novelDetailContent">
            <!-- Novel content will be loaded here -->
        </div>
    </div>

    <!-- Upload Container -->
    <div class="upload-container" id="uploadContainer">
        <button class="back-btn" id="backFromUpload">
            <i class="fas fa-arrow-left"></i> Back
        </button>
        
        <div class="upload-form">
            <div class="upload-header">
                <div class="user-avatar" id="uploadUserAvatar">U</div>
                <div>
                    <h3 id="uploadUserName">User</h3>
                    <p>Create a new <span id="uploadType">Poem</span></p>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <input type="text" id="uploadTitle" placeholder="Title" required>
                </div>
                <div class="form-group">
                    <input type="text" id="uploadCategory" placeholder="Category (Optional)">
                </div>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to upload image or drag and drop</p>
                <p>PNG, JPG, GIF up to 5MB</p>
                <input type="file" id="imageUpload" accept="image/*" hidden>
                <img id="imagePreview" class="image-preview">
            </div>
            
            <div class="form-group">
                <textarea id="uploadContent" placeholder="Write your content here..." required></textarea>
            </div>
            
            <button class="upload-btn" id="submitUpload">
                <i class="fas fa-upload"></i> Upload <span id="uploadTypeText">Poem</span>
                <span id="coinCost">(Cost: 10 Coins)</span>
            </button>
            
            <div class="coin-cost">
                <i class="fas fa-coins"></i> You have <span id="currentCoins">150</span> coins remaining
            </div>
        </div>
    </div>

    <!-- Profile Container -->
    <div class="profile-container" id="profileContainer">
        <button class="back-btn" id="backFromProfile">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </button>
        
        <div class="profile-card">
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">U</div>
                <div class="profile-info">
                    <h3 id="profileName">User Name</h3>
                    <p id="profileEmail">user@example.com</p>
                    <p>Member since: <span id="memberSince">2023</span></p>
                    <button class="logout-btn" id="logoutBtnProfile" style="margin-top: 10px;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
            
            <div class="profile-stats">
                <div class="stat-item">
                    <div class="stat-value" id="statPoems">0</div>
                    <div>Poems</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statNovels">0</div>
                    <div>Novels</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statCoins">150</div>
                    <div>Coins</div>
                </div>
            </div>
            
            <div class="my-poems">
                <h4>My Poems</h4>
                <div class="my-items-grid" id="myPoemsGrid">
                    <!-- User's poems will be loaded here -->
                </div>
            </div>
            
            <div class="my-novels">
                <h4>My Novels</h4>
                <div class="my-items-grid" id="myNovelsGrid">
                    <!-- User's novels will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Container -->
    <div class="admin-container" id="adminContainer">
        <button class="back-btn" id="backFromAdmin">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </button>
        
        <div class="admin-panel">
            <div class="admin-header">
                <h2><i class="fas fa-crown"></i> Admin Panel</h2>
                <p>Manage users, coins, and platform content</p>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="users">
                    <i class="fas fa-users"></i> Manage Users
                </div>
                <div class="admin-tab" data-tab="coins">
                    <i class="fas fa-coins"></i> Coin Management
                </div>
                <div class="admin-tab" data-tab="messages">
                    <i class="fas fa-envelope"></i> Send Messages
                </div>
                <div class="admin-tab" data-tab="stats">
                    <i class="fas fa-chart-bar"></i> Statistics
                </div>
            </div>
            
            <!-- Users Tab -->
            <div class="admin-tab-content active" id="usersTab">
                <div class="search-bar">
                    <input type="text" id="adminUserSearch" placeholder="Search users by name or email...">
                    <i class="fas fa-search"></i>
                </div>
                
                <div class="users-list" id="usersList">
                    <!-- Users will be loaded here -->
                </div>
            </div>
            
            <!-- Coin Management Tab -->
            <div class="admin-tab-content" id="coinsTab">
                <div class="coin-management">
                    <h3><i class="fas fa-coins"></i> Coin Transactions</h3>
                    
                    <div class="coin-action-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="coinUserSelect">Select User</label>
                                <select id="coinUserSelect" class="user-select">
                                    <option value="">Select a user...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="coinAmount">Amount</label>
                                <input type="number" id="coinAmount" placeholder="Enter coin amount" min="1" max="10000">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="coinReason">Reason</label>
                            <input type="text" id="coinReason" placeholder="Reason for coin adjustment (e.g., 'Bonus', 'Purchase', 'Correction')">
                        </div>
                        
                        <div class="coin-actions">
                            <button class="coin-btn add-coins" id="addCoinsBtn">
                                <i class="fas fa-plus-circle"></i> Add Coins
                            </button>
                            <button class="coin-btn remove-coins" id="removeCoinsBtn">
                                <i class="fas fa-minus-circle"></i> Remove Coins
                            </button>
                            <button class="coin-btn set-coins" id="setCoinsBtn">
                                <i class="fas fa-equals"></i> Set Coins
                            </button>
                        </div>
                    </div>
                    
                    <div class="transaction-history">
                        <h4>Recent Transactions</h4>
                        <div class="transactions-list" id="transactionsList">
                            <!-- Transactions will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Send Messages Tab -->
            <div class="admin-tab-content" id="messagesTab">
                <div class="message-form">
                    <div class="form-group">
                        <label for="messageRecipient">Recipient</label>
                        <select id="messageRecipient" class="user-select">
                            <option value="all">All Users</option>
                            <option value="">Select specific user...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="messageTitle">Title</label>
                        <input type="text" id="messageTitle" placeholder="Message title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="messageContent">Message Content</label>
                        <textarea id="messageContent" placeholder="Write your message here..." rows="5" required></textarea>
                    </div>
                    
                    <div class="upload-area message-image-upload" id="messageImageUpload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload image (Optional)</p>
                        <input type="file" id="messageImage" accept="image/*" hidden>
                        <img id="messageImagePreview" class="image-preview">
                    </div>
                    
                    <button class="send-message-btn" id="sendMessageBtn">
                        <i class="fas fa-paper-plane"></i> Send Message
                    </button>
                </div>
            </div>
            
            <!-- Statistics Tab -->
            <div class="admin-tab-content" id="statsTab">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalUsers">0</div>
                            <div class="stat-label">Total Users</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-pen-fancy"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalPoems">0</div>
                            <div class="stat-label">Total Poems</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalNovels">0</div>
                            <div class="stat-label">Total Novels</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalCoins">0</div>
                            <div class="stat-label">Total Coins</div>
                        </div>
                    </div>
                </div>
                
                <div class="recent-activity">
                    <h4>Recent Activity</h4>
                    <div class="activity-list" id="activityList">
                        <!-- Activity will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Add Button -->
    <div class="floating-add-btn" id="floatingAddBtn">
        <i class="fas fa-plus"></i>
    </div>

    <!-- Admin Access Button (only visible to admins) -->
    <div class="admin-access-btn" id="adminAccessBtn" style="display: none;">
        <i class="fas fa-crown"></i>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <div class="notification-content">Notification message</div>
    </div>

    <!-- Admin Message -->
    <div class="admin-message" id="adminMessage">
        <div class="admin-message-header">
            <h3 id="adminMessageTitle">Admin Message</h3>
            <button class="close-message" id="closeAdminMessage">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="admin-message-content" id="adminMessageContent">
            <!-- Admin message content will be loaded here -->
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // Firebase Configuration
       const firebaseConfig = {
  apiKey: "AIzaSyARguxf3-DdOCE9tGLfPLcGIWxRMmHZdns",
  authDomain: "control-my-v1.firebaseapp.com",
  databaseURL: "https://control-my-v1-default-rtdb.firebaseio.com",
  projectId: "control-my-v1",
  storageBucket: "control-my-v1.firebasestorage.app",
  messagingSenderId: "780907108895",
  appId: "1:780907108895:web:2e6455329d329fcf38932a",
  measurementId: "G-PWGS7VL1RV"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // DOM Elements
        const kingLogo = document.getElementById('kingLogo');
        const authContainer = document.getElementById('authContainer');
        const dashboard = document.getElementById('dashboard');
        const themeToggle = document.getElementById('themeToggle');
        const poemSelection = document.getElementById('poemSelection');
        const novelSelection = document.getElementById('novelSelection');
        const poemListContainer = document.getElementById('poemListContainer');
        const novelListContainer = document.getElementById('novelListContainer');
        const poemDetailContainer = document.getElementById('poemDetailContainer');
        const novelDetailContainer = document.getElementById('novelDetailContainer');
        const uploadContainer = document.getElementById('uploadContainer');
        const profileContainer = document.getElementById('profileContainer');
        const adminContainer = document.getElementById('adminContainer');
        const adminAccessBtn = document.getElementById('adminAccessBtn');
        const floatingAddBtn = document.getElementById('floatingAddBtn');
        const notification = document.getElementById('notification');
        const adminMessage = document.getElementById('adminMessage');

        // State variables
        let currentUser = null;
        let isAdmin = false;
        let currentUploadType = 'poem';
        let allPoems = [];
        let allNovels = [];
        let userPoems = [];
        let userNovels = [];
        let isEditing = false;
        let editingContentId = null;
        let likedPoems = new Set();
        let likedNovels = new Set();

        // Initialize bubbles
        function initBubbles() {
            const bubblesContainer = document.getElementById('bubbles');
            bubblesContainer.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                
                const size = Math.random() * 60 + 20;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.animationDelay = `${Math.random() * 15}s`;
                bubble.style.animationDuration = `${Math.random() * 10 + 15}s`;
                bubble.style.opacity = Math.random() * 0.5 + 0.1;
                
                const colors = [
                    'rgba(108, 99, 255, 0.3)',
                    'rgba(255, 101, 132, 0.3)',
                    'rgba(54, 209, 220, 0.3)',
                    'rgba(255, 255, 255, 0.2)'
                ];
                bubble.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                bubblesContainer.appendChild(bubble);
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const icon = notification.querySelector('i');
            const content = notification.querySelector('.notification-content');
            
            icon.className = 'fas ' + (
                type === 'success' ? 'fa-check-circle' :
                type === 'error' ? 'fa-exclamation-circle' :
                'fa-info-circle'
            );
            
            content.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Show/hide sections
        function showSection(section) {
            const sections = [
                dashboard, poemListContainer, novelListContainer,
                poemDetailContainer, novelDetailContainer,
                uploadContainer, profileContainer, adminContainer
            ];
            
            sections.forEach(sec => {
                if (sec) sec.style.display = 'none';
            });
            
            if (section) {
                section.style.display = 'block';
                
                if (section === dashboard || section === poemListContainer || 
                    section === novelListContainer || section === profileContainer) {
                    floatingAddBtn.style.display = 'flex';
                } else {
                    floatingAddBtn.style.display = 'none';
                }
                
                if (isAdmin && (section === dashboard || section === poemListContainer || 
                    section === novelListContainer || section === profileContainer)) {
                    adminAccessBtn.style.display = 'flex';
                } else {
                    adminAccessBtn.style.display = 'none';
                }
            }
        }

        // Logout function
        function logoutUser() {
            if (confirm("Are you sure you want to logout?")) {
                auth.signOut()
                    .then(() => {
                        showNotification("Logged out successfully", "success");
                        currentUser = null;
                        isAdmin = false;
                        
                        authContainer.style.display = 'flex';
                        showSection(null);
                        adminAccessBtn.style.display = 'none';
                        
                        document.getElementById('loginEmail').value = '';
                        document.getElementById('loginPassword').value = '';
                        
                        kingLogo.style.display = 'flex';
                        setTimeout(() => {
                            kingLogo.style.display = 'none';
                            authContainer.style.display = 'flex';
                        }, 2000);
                    })
                    .catch((error) => {
                        console.error("Logout error:", error);
                        showNotification("Logout failed: " + error.message, "error");
                    });
            }
        }

        // Update user info in UI
        function updateUserInfo(user) {
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            const userAvatar = document.getElementById('userAvatar');
            const uploadUserName = document.getElementById('uploadUserName');
            const uploadUserAvatar = document.getElementById('uploadUserAvatar');
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');
            const profileAvatar = document.getElementById('profileAvatar');
            
            if (user) {
                const displayName = user.displayName || user.email.split('@')[0];
                const firstLetter = displayName.charAt(0).toUpperCase();
                
                if (userName) userName.textContent = displayName;
                if (userEmail) userEmail.textContent = user.email;
                if (userAvatar) {
                    userAvatar.textContent = firstLetter;
                    userAvatar.style.background = `linear-gradient(45deg, var(--primary), var(--secondary))`;
                }
                
                if (uploadUserName) uploadUserName.textContent = displayName;
                if (uploadUserAvatar) {
                    uploadUserAvatar.textContent = firstLetter;
                    uploadUserAvatar.style.background = `linear-gradient(45deg, var(--primary), var(--secondary))`;
                }
                
                if (profileName) profileName.textContent = displayName;
                if (profileEmail) profileEmail.textContent = user.email;
                if (profileAvatar) {
                    profileAvatar.textContent = firstLetter;
                    profileAvatar.style.background = `linear-gradient(45deg, var(--primary), var(--secondary))`;
                }
                
                const memberSince = document.getElementById('memberSince');
                if (memberSince) {
                    memberSince.textContent = new Date(user.metadata.creationTime).getFullYear();
                }
                
                updateUserCoins();
            }
        }

        // Update user coins
        function updateUserCoins() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        const coins = userData.coins || 150;
                        
                        const coinDisplays = [
                            document.getElementById('userCoins'),
                            document.getElementById('currentCoins'),
                            document.getElementById('statCoins')
                        ];
                        
                        coinDisplays.forEach(display => {
                            if (display) display.textContent = coins;
                        });
                    }
                })
                .catch(error => {
                    console.error("Error getting user coins:", error);
                });
        }

        // Check if user is admin
        function checkAdminStatus(user) {
            if (!user) return false;
            
            db.collection('users').doc(user.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        isAdmin = userData.isAdmin || false;
                        
                        if (isAdmin) {
                            adminAccessBtn.style.display = 'flex';
                            showNotification("Admin privileges enabled", "success");
                        } else {
                            adminAccessBtn.style.display = 'none';
                        }
                    }
                })
                .catch(error => {
                    console.error("Error checking admin status:", error);
                });
        }

        // Load user likes
        function loadUserLikes() {
            if (!currentUser) return;
            
            likedPoems.clear();
            likedNovels.clear();
            
            // Load liked poems
            db.collectionGroup('likes').where('userId', '==', currentUser.uid).where('type', '==', 'poem').get()
                .then(querySnapshot => {
                    querySnapshot.forEach(doc => {
                        likedPoems.add(doc.data().contentId);
                    });
                    loadPoems();
                });
            
            // Load liked novels
            db.collectionGroup('likes').where('userId', '==', currentUser.uid).where('type', '==', 'novel').get()
                .then(querySnapshot => {
                    querySnapshot.forEach(doc => {
                        likedNovels.add(doc.data().contentId);
                    });
                    loadNovels();
                });
        }

        // Toggle like for poem or novel
        async function toggleLike(contentId, type) {
            if (!currentUser) {
                showNotification("Please login to like content", "error");
                return;
            }
            
            const collectionName = type === 'poem' ? 'poems' : 'novels';
            const likeRef = db.collection(collectionName).doc(contentId).collection('likes').doc(currentUser.uid);
            
            try {
                const likeDoc = await likeRef.get();
                
                if (likeDoc.exists) {
                    // Unlike
                    await likeRef.delete();
                    
                    // Update like count
                    await db.collection(collectionName).doc(contentId).update({
                        likeCount: firebase.firestore.FieldValue.increment(-1)
                    });
                    
                    if (type === 'poem') {
                        likedPoems.delete(contentId);
                    } else {
                        likedNovels.delete(contentId);
                    }
                    
                    showNotification("Like removed", "success");
                } else {
                    // Like
                    await likeRef.set({
                        userId: currentUser.uid,
                        contentId: contentId,
                        type: type,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update like count
                    await db.collection(collectionName).doc(contentId).update({
                        likeCount: firebase.firestore.FieldValue.increment(1)
                    });
                    
                    if (type === 'poem') {
                        likedPoems.add(contentId);
                    } else {
                        likedNovels.add(contentId);
                    }
                    
                    showNotification("Liked!", "success");
                }
                
                // Refresh the view
                if (type === 'poem') {
                    loadPoems();
                    if (poemDetailContainer.style.display === 'block') {
                        const currentPoemId = document.getElementById('poemDetailTitle').dataset.id;
                        if (currentPoemId === contentId) {
                            showPoemDetail(allPoems.find(p => p.id === contentId));
                        }
                    }
                } else {
                    loadNovels();
                    if (novelDetailContainer.style.display === 'block') {
                        const currentNovelId = document.getElementById('novelDetailTitle').dataset.id;
                        if (currentNovelId === contentId) {
                            showNovelDetail(allNovels.find(n => n.id === contentId));
                        }
                    }
                }
                
            } catch (error) {
                console.error("Error toggling like:", error);
                showNotification("Error updating like", "error");
            }
        }

        // Load poems
        function loadPoems() {
            db.collection('poems').orderBy('createdAt', 'desc').get()
                .then(querySnapshot => {
                    allPoems = [];
                    const poemsGrid = document.getElementById('poemsGrid');
                    if (!poemsGrid) return;
                    
                    poemsGrid.innerHTML = '';
                    
                    querySnapshot.forEach(doc => {
                        const poem = { id: doc.id, ...doc.data() };
                        poem.isLiked = likedPoems.has(doc.id);
                        allPoems.push(poem);
                        
                        const poemItem = document.createElement('div');
                        poemItem.className = 'poem-item';
                        poemItem.dataset.id = doc.id;
                        
                        const previewText = poem.content.length > 150 
                            ? poem.content.substring(0, 150) + '...' 
                            : poem.content;
                        
                        poemItem.innerHTML = `
                            ${poem.imageUrl ? `<img src="${poem.imageUrl}" alt="${poem.title}" class="item-image">` : 
                            `<div class="item-image" style="background: linear-gradient(45deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                <i class="fas fa-pen-fancy"></i>
                            </div>`}
                            <h3 class="item-title">${poem.title}</h3>
                            <p class="item-author">By ${poem.authorName || 'Unknown'}</p>
                            <p class="item-preview">${previewText}</p>
                            <div class="like-section">
                                <button class="like-btn ${poem.isLiked ? 'liked' : ''}" data-id="${poem.id}" data-type="poem">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <span class="like-count">${poem.likeCount || 0}</span>
                            </div>
                        `;
                        
                        poemItem.addEventListener('click', (e) => {
                            if (!e.target.closest('.like-btn')) {
                                showPoemDetail(poem);
                            }
                        });
                        
                        const likeBtn = poemItem.querySelector('.like-btn');
                        likeBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleLike(poem.id, 'poem');
                        });
                        
                        poemsGrid.appendChild(poemItem);
                    });
                })
                .catch(error => {
                    console.error("Error loading poems:", error);
                    showNotification("Error loading poems", "error");
                });
        }

        // Load novels
        function loadNovels() {
            db.collection('novels').orderBy('createdAt', 'desc').get()
                .then(querySnapshot => {
                    allNovels = [];
                    const novelsGrid = document.getElementById('novelsGrid');
                    if (!novelsGrid) return;
                    
                    novelsGrid.innerHTML = '';
                    
                    querySnapshot.forEach(doc => {
                        const novel = { id: doc.id, ...doc.data() };
                        novel.isLiked = likedNovels.has(doc.id);
                        allNovels.push(novel);
                        
                        const novelItem = document.createElement('div');
                        novelItem.className = 'novel-item';
                        novelItem.dataset.id = doc.id;
                        
                        const previewText = novel.content.length > 150 
                            ? novel.content.substring(0, 150) + '...' 
                            : novel.content;
                        
                        novelItem.innerHTML = `
                            ${novel.imageUrl ? `<img src="${novel.imageUrl}" alt="${novel.title}" class="item-image">` : 
                            `<div class="item-image" style="background: linear-gradient(45deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                <i class="fas fa-book-open"></i>
                            </div>`}
                            <h3 class="item-title">${novel.title}</h3>
                            <p class="item-author">By ${novel.authorName || 'Unknown'}</p>
                            <p class="item-preview">${previewText}</p>
                            <div class="like-section">
                                <button class="like-btn ${novel.isLiked ? 'liked' : ''}" data-id="${novel.id}" data-type="novel">
                                    <i class="fas fa-heart"></i>
                                </button>
                                <span class="like-count">${novel.likeCount || 0}</span>
                            </div>
                        `;
                        
                        novelItem.addEventListener('click', (e) => {
                            if (!e.target.closest('.like-btn')) {
                                showNovelDetail(novel);
                            }
                        });
                        
                        const likeBtn = novelItem.querySelector('.like-btn');
                        likeBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleLike(novel.id, 'novel');
                        });
                        
                        novelsGrid.appendChild(novelItem);
                    });
                })
                .catch(error => {
                    console.error("Error loading novels:", error);
                    showNotification("Error loading novels", "error");
                });
        }

        // Load user's content
        function loadUserContent() {
            if (!currentUser) return;
            
            db.collection('poems').where('userId', '==', currentUser.uid).get()
                .then(querySnapshot => {
                    userPoems = [];
                    const myPoemsGrid = document.getElementById('myPoemsGrid');
                    if (!myPoemsGrid) return;
                    
                    myPoemsGrid.innerHTML = '';
                    
                    querySnapshot.forEach(doc => {
                        const poem = { id: doc.id, ...doc.data() };
                        userPoems.push(poem);
                        
                        const poemItem = document.createElement('div');
                        poemItem.className = 'my-item';
                        poemItem.dataset.id = doc.id;
                        
                        poemItem.innerHTML = `
                            <div class="my-item-title">${poem.title}</div>
                            <div class="item-actions">
                                <button class="action-btn edit-btn" data-id="${doc.id}" data-type="poem">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" data-id="${doc.id}" data-type="poem">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        
                        myPoemsGrid.appendChild(poemItem);
                    });
                    
                    const statPoems = document.getElementById('statPoems');
                    if (statPoems) {
                        statPoems.textContent = userPoems.length;
                    }
                })
                .catch(error => {
                    console.error("Error loading user poems:", error);
                });
            
            db.collection('novels').where('userId', '==', currentUser.uid).get()
                .then(querySnapshot => {
                    userNovels = [];
                    const myNovelsGrid = document.getElementById('myNovelsGrid');
                    if (!myNovelsGrid) return;
                    
                    myNovelsGrid.innerHTML = '';
                    
                    querySnapshot.forEach(doc => {
                        const novel = { id: doc.id, ...doc.data() };
                        userNovels.push(novel);
                        
                        const novelItem = document.createElement('div');
                        novelItem.className = 'my-item';
                        novelItem.dataset.id = doc.id;
                        
                        novelItem.innerHTML = `
                            <div class="my-item-title">${novel.title}</div>
                            <div class="item-actions">
                                <button class="action-btn edit-btn" data-id="${doc.id}" data-type="novel">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" data-id="${doc.id}" data-type="novel">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        
                        myNovelsGrid.appendChild(novelItem);
                    });
                    
                    const statNovels = document.getElementById('statNovels');
                    if (statNovels) {
                        statNovels.textContent = userNovels.length;
                    }
                    
                    setupProfileEventListeners();
                })
                .catch(error => {
                    console.error("Error loading user novels:", error);
                });
        }

        // Setup event listeners for profile actions
        function setupProfileEventListeners() {
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const contentId = this.getAttribute('data-id');
                    const contentType = this.getAttribute('data-type');
                    editContent(contentId, contentType);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const contentId = this.getAttribute('data-id');
                    const contentType = this.getAttribute('data-type');
                    deleteContent(contentId, contentType);
                });
            });
        }

        // Edit content function
        function editContent(contentId, contentType) {
            isEditing = true;
            editingContentId = contentId;
            
            const collectionName = contentType === 'poem' ? 'poems' : 'novels';
            
            db.collection(collectionName).doc(contentId).get()
                .then(doc => {
                    if (!doc.exists) {
                        showNotification("Content not found", "error");
                        return;
                    }
                    
                    const content = doc.data();
                    
                    currentUploadType = contentType;
                    
                    const uploadType = document.getElementById('uploadType');
                    const uploadTypeText = document.getElementById('uploadTypeText');
                    const coinCost = document.getElementById('coinCost');
                    
                    if (uploadType) uploadType.textContent = contentType === 'poem' ? 'Poem' : 'Novel';
                    if (uploadTypeText) uploadTypeText.textContent = contentType === 'poem' ? 'Poem' : 'Novel';
                    if (coinCost) coinCost.textContent = '(Editing - No Coin Cost)';
                    
                    document.getElementById('uploadTitle').value = content.title || '';
                    document.getElementById('uploadCategory').value = content.category || '';
                    document.getElementById('uploadContent').value = content.content || '';
                    
                    const imagePreview = document.getElementById('imagePreview');
                    const imageUpload = document.getElementById('imageUpload');
                    if (content.imageUrl) {
                        imagePreview.src = content.imageUrl;
                        imagePreview.style.display = 'block';
                        imageUpload.dataset.oldImageUrl = content.imageUrl;
                    } else {
                        imagePreview.style.display = 'none';
                        delete imageUpload.dataset.oldImageUrl;
                    }
                    
                    const uploadBtn = document.getElementById('submitUpload');
                    uploadBtn.innerHTML = `<i class="fas fa-save"></i> Update ${contentType === 'poem' ? 'Poem' : 'Novel'}`;
                    
                    showSection(uploadContainer);
                })
                .catch(error => {
                    console.error("Error fetching content:", error);
                    showNotification("Error loading content for editing", "error");
                });
        }

        // Update content function
        async function updateContent() {
            const title = document.getElementById('uploadTitle').value.trim();
            const category = document.getElementById('uploadCategory').value.trim();
            const contentText = document.getElementById('uploadContent').value.trim();
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];
            
            if (!title || !contentText) {
                showNotification("Please fill in title and content", "error");
                return;
            }
            
            const collectionName = currentUploadType === 'poem' ? 'poems' : 'novels';
            const docRef = db.collection(collectionName).doc(editingContentId);
            
            try {
                const doc = await docRef.get();
                if (!doc.exists) {
                    showNotification("Content not found", "error");
                    return;
                }
                
                const contentData = doc.data();
                if (contentData.userId !== currentUser.uid) {
                    showNotification("You can only edit your own content", "error");
                    return;
                }
                
                let imageUrl = contentData.imageUrl;
                if (file) {
                    try {
                        imageUrl = await uploadImage(file);
                    } catch (error) {
                        console.error("Image upload error:", error);
                        showNotification("Error uploading image", "error");
                        return;
                    }
                }
                
                const updateData = {
                    title: title,
                    category: category || null,
                    content: contentText,
                    imageUrl: imageUrl,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await docRef.update(updateData);
                
                showNotification(`${currentUploadType === 'poem' ? 'Poem' : 'Novel'} updated successfully!`, "success");
                
                isEditing = false;
                editingContentId = null;
                
                document.getElementById('uploadTitle').value = '';
                document.getElementById('uploadCategory').value = '';
                document.getElementById('uploadContent').value = '';
                document.getElementById('imageUpload').value = '';
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('imagePreview').src = '';
                
                const uploadBtn = document.getElementById('submitUpload');
                uploadBtn.innerHTML = `<i class="fas fa-upload"></i> Upload <span id="uploadTypeText">Poem</span>
                    <span id="coinCost">(Cost: 10 Coins)</span>`;
                
                loadUserContent();
                if (currentUploadType === 'poem') {
                    loadPoems();
                    showSection(poemListContainer);
                } else {
                    loadNovels();
                    showSection(novelListContainer);
                }
                
            } catch (error) {
                console.error("Error updating content:", error);
                showNotification("Error updating content", "error");
            }
        }

        // Delete content function
        async function deleteContent(contentId, contentType) {
            if (!confirm(`Are you sure you want to delete this ${contentType}? This action cannot be undone.`)) {
                return;
            }
            
            const collectionName = contentType === 'poem' ? 'poems' : 'novels';
            const docRef = db.collection(collectionName).doc(contentId);
            
            try {
                const doc = await docRef.get();
                if (!doc.exists) {
                    showNotification("Content not found", "error");
                    return;
                }
                
                const contentData = doc.data();
                if (contentData.userId !== currentUser.uid) {
                    showNotification("You can only delete your own content", "error");
                    return;
                }
                
                await docRef.delete();
                
                showNotification(`${contentType === 'poem' ? 'Poem' : 'Novel'} deleted successfully`, "success");
                
                loadUserContent();
                if (contentType === 'poem') {
                    loadPoems();
                } else {
                    loadNovels();
                }
                
            } catch (error) {
                console.error("Error deleting content:", error);
                showNotification("Error deleting content", "error");
            }
        }

        // Show poem detail
        function showPoemDetail(poem) {
            document.getElementById('poemDetailTitle').textContent = poem.title;
            document.getElementById('poemDetailTitle').dataset.id = poem.id;
            document.getElementById('poemDetailAuthor').textContent = `By ${poem.authorName || 'Unknown'}`;
            
            const likeBtn = document.getElementById('poemDetailLikeBtn');
            const likeCount = document.getElementById('poemDetailLikeCount');
            
            likeBtn.className = `like-btn ${poem.isLiked ? 'liked' : ''}`;
            likeBtn.onclick = () => toggleLike(poem.id, 'poem');
            likeCount.textContent = poem.likeCount || 0;
            
            const poemImage = document.getElementById('poemDetailImage');
            if (poem.imageUrl) {
                poemImage.src = poem.imageUrl;
                poemImage.style.display = 'block';
            } else {
                poemImage.style.display = 'none';
            }
            
            document.getElementById('poemDetailContent').innerHTML = `
                <p>${poem.content.replace(/\n/g, '<br>')}</p>
                ${poem.category ? `<p><strong>Category:</strong> ${poem.category}</p>` : ''}
                <p><strong>Posted:</strong> ${new Date(poem.createdAt?.toDate()).toLocaleDateString()}</p>
            `;
            
            showSection(poemDetailContainer);
        }

        // Show novel detail
        function showNovelDetail(novel) {
            document.getElementById('novelDetailTitle').textContent = novel.title;
            document.getElementById('novelDetailTitle').dataset.id = novel.id;
            document.getElementById('novelDetailAuthor').textContent = `By ${novel.authorName || 'Unknown'}`;
            
            const likeBtn = document.getElementById('novelDetailLikeBtn');
            const likeCount = document.getElementById('novelDetailLikeCount');
            
            likeBtn.className = `like-btn ${novel.isLiked ? 'liked' : ''}`;
            likeBtn.onclick = () => toggleLike(novel.id, 'novel');
            likeCount.textContent = novel.likeCount || 0;
            
            const novelImage = document.getElementById('novelDetailImage');
            if (novel.imageUrl) {
                novelImage.src = novel.imageUrl;
                novelImage.style.display = 'block';
            } else {
                novelImage.style.display = 'none';
            }
            
            document.getElementById('novelDetailContent').innerHTML = `
                <p>${novel.content.replace(/\n/g, '<br>')}</p>
                ${novel.category ? `<p><strong>Category:</strong> ${novel.category}</p>` : ''}
                <p><strong>Posted:</strong> ${new Date(novel.createdAt?.toDate()).toLocaleDateString()}</p>
            `;
            
            showSection(novelDetailContainer);
        }

        // Setup upload
        function setupUpload(type) {
            currentUploadType = type;
            isEditing = false;
            editingContentId = null;
            
            const uploadType = document.getElementById('uploadType');
            const uploadTypeText = document.getElementById('uploadTypeText');
            const coinCost = document.getElementById('coinCost');
            
            if (uploadType) uploadType.textContent = type === 'poem' ? 'Poem' : 'Novel';
            if (uploadTypeText) uploadTypeText.textContent = type === 'poem' ? 'Poem' : 'Novel';
            if (coinCost) coinCost.textContent = '(Cost: 10 Coins)';
            
            document.getElementById('uploadTitle').value = '';
            document.getElementById('uploadCategory').value = '';
            document.getElementById('uploadContent').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imagePreview').src = '';
            document.getElementById('imageUpload').value = '';
            
            const uploadBtn = document.getElementById('submitUpload');
            uploadBtn.innerHTML = `<i class="fas fa-upload"></i> Upload <span id="uploadTypeText">${type === 'poem' ? 'Poem' : 'Novel'}</span>
                <span id="coinCost">(Cost: 10 Coins)</span>`;
            
            showSection(uploadContainer);
        }

        // Handle file upload
        function uploadImage(file) {
            return new Promise((resolve, reject) => {
                if (!file) {
                    resolve(null);
                    return;
                }
                
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`images/${Date.now()}_${file.name}`);
                
                fileRef.put(file).then(snapshot => {
                    snapshot.ref.getDownloadURL().then(url => {
                        resolve(url);
                    });
                }).catch(error => {
                    reject(error);
                });
            });
        }

        // Handle content upload
        async function handleUpload() {
            if (!currentUser) {
                showNotification("Please login first", "error");
                return;
            }
            
            const title = document.getElementById('uploadTitle').value.trim();
            const category = document.getElementById('uploadCategory').value.trim();
            const content = document.getElementById('uploadContent').value.trim();
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];
            
            if (!title || !content) {
                showNotification("Please fill in title and content", "error");
                return;
            }
            
            if (isEditing) {
                await updateContent();
                return;
            }
            
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            const userData = userDoc.data();
            const currentCoins = userData.coins || 150;
            
            if (currentCoins < 10) {
                showNotification("Not enough coins. You need 10 coins to upload.", "error");
                return;
            }
            
            let imageUrl = null;
            if (file) {
                try {
                    imageUrl = await uploadImage(file);
                } catch (error) {
                    showNotification("Error uploading image", "error");
                    console.error("Image upload error:", error);
                    return;
                }
            }
            
            const data = {
                title,
                category: category || null,
                content,
                imageUrl,
                authorName: currentUser.displayName || currentUser.email.split('@')[0],
                userId: currentUser.uid,
                userEmail: currentUser.email,
                likeCount: 0,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            const collectionName = currentUploadType === 'poem' ? 'poems' : 'novels';
            
            db.collection(collectionName).add(data)
                .then(async () => {
                    const newCoins = currentCoins - 10;
                    await db.collection('users').doc(currentUser.uid).update({
                        coins: newCoins
                    });
                    
                    showNotification(`${currentUploadType === 'poem' ? 'Poem' : 'Novel'} uploaded successfully!`, "success");
                    
                    document.getElementById('uploadTitle').value = '';
                    document.getElementById('uploadCategory').value = '';
                    document.getElementById('uploadContent').value = '';
                    document.getElementById('imageUpload').value = '';
                    document.getElementById('imagePreview').style.display = 'none';
                    document.getElementById('imagePreview').src = '';
                    
                    updateUserCoins();
                    loadUserContent();
                    
                    if (currentUploadType === 'poem') {
                        loadPoems();
                        showSection(poemListContainer);
                    } else {
                        loadNovels();
                        showSection(novelListContainer);
                    }
                })
                .catch(error => {
                    console.error("Error uploading:", error);
                    showNotification("Error uploading content", "error");
                });
        }

        // Check for admin messages
        function checkAdminMessages() {
            if (!currentUser) return;
            
            db.collection('adminMessages')
                .where('recipients', 'array-contains', currentUser.email)
                .where('isActive', '==', true)
                .get()
                .then(querySnapshot => {
                    querySnapshot.forEach(doc => {
                        const message = doc.data();
                        showAdminMessage(message);
                        
                        db.collection('adminMessages').doc(doc.id).update({
                            readBy: firebase.firestore.FieldValue.arrayUnion(currentUser.email)
                        });
                    });
                });
        }

        // Show admin message
        function showAdminMessage(message) {
            document.getElementById('adminMessageTitle').textContent = message.title || 'Admin Message';
            
            let content = `<p>${message.content || ''}</p>`;
            if (message.imageUrl) {
                content += `<img src="${message.imageUrl}" alt="Admin Message Image">`;
            }
            
            document.getElementById('adminMessageContent').innerHTML = content;
            adminMessage.classList.add('show');
        }

        // ADMIN FUNCTIONS

        // Load all users for admin
        function loadAllUsers() {
            if (!isAdmin) return;
            
            db.collection('users').orderBy('createdAt', 'desc').get()
                .then(querySnapshot => {
                    const usersList = document.getElementById('usersList');
                    const coinUserSelect = document.getElementById('coinUserSelect');
                    const messageRecipient = document.getElementById('messageRecipient');
                    
                    if (!usersList) return;
                    
                    usersList.innerHTML = '';
                    coinUserSelect.innerHTML = '<option value="">Select a user...</option>';
                    messageRecipient.innerHTML = '<option value="all">All Users</option><option value="">Select specific user...</option>';
                    
                    querySnapshot.forEach(doc => {
                        const user = { id: doc.id, ...doc.data() };
                        
                        const userItem = document.createElement('div');
                        userItem.className = 'user-item';
                        userItem.dataset.id = doc.id;
                        
                        const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : 
                                       user.nickname ? user.nickname.charAt(0).toUpperCase() : 
                                       user.email.charAt(0).toUpperCase();
                        
                        userItem.innerHTML = `
                            <div class="user-info">
                                <div class="user-avatar-small">${firstLetter}</div>
                                <div class="user-details">
                                    <h4>${user.nickname || user.name || user.email.split('@')[0]}</h4>
                                    <p>${user.email}</p>
                                    ${user.isAdmin ? '<span class="admin-badge"><i class="fas fa-crown"></i> Admin</span>' : ''}
                                </div>
                            </div>
                            <div class="user-coins">
                                <i class="fas fa-coins"></i>
                                <span>${user.coins || 150} Coins</span>
                            </div>
                            <div class="user-actions">
                                <button class="user-action-btn add-coin-btn" title="Add Coins" data-id="${doc.id}" data-email="${user.email}">
                                    <i class="fas fa-plus-circle"></i>
                                </button>
                                <button class="user-action-btn remove-coin-btn" title="Remove Coins" data-id="${doc.id}" data-email="${user.email}">
                                    <i class="fas fa-minus-circle"></i>
                                </button>
                                <button class="user-action-btn message-btn" title="Send Message" data-id="${doc.id}" data-email="${user.email}">
                                    <i class="fas fa-envelope"></i>
                                </button>
                            </div>
                        `;
                        
                        usersList.appendChild(userItem);
                        
                        const optionText = `${user.nickname || user.name || user.email.split('@')[0]} (${user.email})`;
                        const coinOption = new Option(optionText, doc.id);
                        const messageOption = new Option(optionText, user.email);
                        
                        coinUserSelect.add(coinOption);
                        messageRecipient.add(messageOption);
                    });
                    
                    setupUserActionButtons();
                })
                .catch(error => {
                    console.error("Error loading users:", error);
                    showNotification("Error loading users", "error");
                });
        }

        // Load transaction history
        function loadTransactions() {
            if (!isAdmin) return;
            
            db.collection('adminTransactions')
                .orderBy('timestamp', 'desc')
                .limit(20)
                .get()
                .then(querySnapshot => {
                    const transactionsList = document.getElementById('transactionsList');
                    if (!transactionsList) return;
                    
                    transactionsList.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        transactionsList.innerHTML = '<p class="no-data">No transactions yet</p>';
                        return;
                    }
                    
                    querySnapshot.forEach(doc => {
                        const transaction = doc.data();
                        
                        const transactionItem = document.createElement('div');
                        transactionItem.className = `transaction-item ${transaction.type}`;
                        
                        let amountClass = '';
                        let amountPrefix = '';
                        
                        switch (transaction.type) {
                            case 'add':
                                amountClass = 'added';
                                amountPrefix = '+';
                                break;
                            case 'remove':
                                amountClass = 'removed';
                                amountPrefix = '-';
                                break;
                            case 'set':
                                amountClass = 'set';
                                amountPrefix = '=';
                                break;
                        }
                        
                        const date = transaction.timestamp?.toDate ? 
                            transaction.timestamp.toDate().toLocaleString() : 
                            new Date().toLocaleString();
                        
                        transactionItem.innerHTML = `
                            <div class="transaction-header">
                                <div class="transaction-user">${transaction.userEmail}</div>
                                <div class="transaction-amount ${amountClass}">${amountPrefix}${transaction.amount} Coins</div>
                            </div>
                            <div class="transaction-details">
                                <div><strong>Reason:</strong> ${transaction.reason || 'No reason provided'}</div>
                                <div><strong>Admin:</strong> ${transaction.adminEmail}</div>
                                <div><strong>Time:</strong> ${date}</div>
                            </div>
                        `;
                        
                        transactionsList.appendChild(transactionItem);
                    });
                })
                .catch(error => {
                    console.error("Error loading transactions:", error);
                });
        }

        // Load statistics
        function loadStatistics() {
            if (!isAdmin) return;
            
            db.collection('users').get()
                .then(querySnapshot => {
                    document.getElementById('totalUsers').textContent = querySnapshot.size;
                    
                    let totalCoins = 0;
                    querySnapshot.forEach(doc => {
                        const user = doc.data();
                        totalCoins += user.coins || 150;
                    });
                    
                    document.getElementById('totalCoins').textContent = totalCoins;
                });
            
            db.collection('poems').get()
                .then(querySnapshot => {
                    document.getElementById('totalPoems').textContent = querySnapshot.size;
                });
            
            db.collection('novels').get()
                .then(querySnapshot => {
                    document.getElementById('totalNovels').textContent = querySnapshot.size;
                });
            
            loadRecentActivity();
        }

        // Load recent activity
        function loadRecentActivity() {
            const activityList = document.getElementById('activityList');
            if (!activityList) return;
            
            Promise.all([
                db.collection('poems').orderBy('createdAt', 'desc').limit(5).get(),
                db.collection('novels').orderBy('createdAt', 'desc').limit(5).get(),
                db.collection('adminTransactions').orderBy('timestamp', 'desc').limit(5).get()
            ])
            .then(([poemsSnap, novelsSnap, transactionsSnap]) => {
                activityList.innerHTML = '';
                
                const activities = [];
                
                poemsSnap.forEach(doc => {
                    const poem = doc.data();
                    activities.push({
                        type: 'poem',
                        title: poem.title,
                        user: poem.authorName,
                        time: poem.createdAt
                    });
                });
                
                novelsSnap.forEach(doc => {
                    const novel = doc.data();
                    activities.push({
                        type: 'novel',
                        title: novel.title,
                        user: novel.authorName,
                        time: novel.createdAt
                    });
                });
                
                transactionsSnap.forEach(doc => {
                    const transaction = doc.data();
                    activities.push({
                        type: 'transaction',
                        title: `${transaction.type === 'add' ? 'Added' : transaction.type === 'remove' ? 'Removed' : 'Set'} ${transaction.amount} coins`,
                        user: transaction.userEmail,
                        time: transaction.timestamp
                    });
                });
                
                activities.sort((a, b) => {
                    const timeA = a.time?.toDate ? a.time.toDate().getTime() : new Date().getTime();
                    const timeB = b.time?.toDate ? b.time.toDate().getTime() : new Date().getTime();
                    return timeB - timeA;
                });
                
                activities.slice(0, 10).forEach(activity => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'activity-item';
                    
                    let icon = '';
                    let iconClass = '';
                    
                    switch (activity.type) {
                        case 'poem':
                            icon = 'fas fa-pen-fancy';
                            iconClass = 'poem-activity';
                            break;
                        case 'novel':
                            icon = 'fas fa-book-open';
                            iconClass = 'novel-activity';
                            break;
                        case 'transaction':
                            icon = 'fas fa-coins';
                            iconClass = 'coin-activity';
                            break;
                    }
                    
                    const time = activity.time?.toDate ? 
                        activity.time.toDate().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 
                        new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon ${iconClass}">
                            <i class="${icon}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">
                                <span class="activity-user">${activity.user}</span> 
                                ${activity.type === 'transaction' ? activity.title : `${activity.type === 'poem' ? 'posted a poem:' : 'posted a novel:'} ${activity.title}`}
                            </div>
                            <div class="activity-time">${time}</div>
                        </div>
                    `;
                    
                    activityList.appendChild(activityItem);
                });
            });
        }

        // Setup user action buttons for admin
        function setupUserActionButtons() {
            document.querySelectorAll('.add-coin-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const userId = this.getAttribute('data-id');
                    const userEmail = this.getAttribute('data-email');
                    
                    const amount = prompt(`Enter coin amount to add to ${userEmail}:`, "10");
                    if (amount && !isNaN(amount) && parseInt(amount) > 0) {
                        const reason = prompt("Reason for adding coins (optional):", "Bonus");
                        addCoinsToUser(userId, parseInt(amount), reason || "Bonus");
                    }
                });
            });
            
            document.querySelectorAll('.remove-coin-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const userId = this.getAttribute('data-id');
                    const userEmail = this.getAttribute('data-email');
                    
                    const amount = prompt(`Enter coin amount to remove from ${userEmail}:`, "10");
                    if (amount && !isNaN(amount) && parseInt(amount) > 0) {
                        const reason = prompt("Reason for removing coins (optional):", "Correction");
                        removeCoinsFromUser(userId, parseInt(amount), reason || "Correction");
                    }
                });
            });
            
            document.querySelectorAll('.message-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const userEmail = this.getAttribute('data-email');
                    
                    document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelectorAll('.admin-tab-content').forEach(content => content.classList.remove('active'));
                    
                    document.querySelector('.admin-tab[data-tab="messages"]').classList.add('active');
                    document.getElementById('messagesTab').classList.add('active');
                    
                    document.getElementById('messageRecipient').value = userEmail;
                });
            });
        }

        // Add coins to user
        async function addCoinsToUser(userId, amount, reason) {
            if (!isAdmin || !currentUser) {
                showNotification("Admin access required", "error");
                return;
            }
            
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (!userDoc.exists) {
                    showNotification("User not found", "error");
                    return;
                }
                
                const userData = userDoc.data();
                const currentCoins = userData.coins || 150;
                const newCoins = currentCoins + amount;
                
                await db.collection('users').doc(userId).update({
                    coins: newCoins,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await db.collection('adminTransactions').add({
                    userId: userId,
                    userEmail: userData.email,
                    adminId: currentUser.uid,
                    adminEmail: currentUser.email,
                    type: 'add',
                    amount: amount,
                    previousCoins: currentCoins,
                    newCoins: newCoins,
                    reason: reason,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification(`Added ${amount} coins to ${userData.email}`, "success");
                
                loadAllUsers();
                loadTransactions();
                loadStatistics();
                
            } catch (error) {
                console.error("Error adding coins:", error);
                showNotification("Error adding coins", "error");
            }
        }

        // Remove coins from user
        async function removeCoinsFromUser(userId, amount, reason) {
            if (!isAdmin || !currentUser) {
                showNotification("Admin access required", "error");
                return;
            }
            
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (!userDoc.exists) {
                    showNotification("User not found", "error");
                    return;
                }
                
                const userData = userDoc.data();
                const currentCoins = userData.coins || 150;
                const newCoins = Math.max(0, currentCoins - amount);
                
                await db.collection('users').doc(userId).update({
                    coins: newCoins,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await db.collection('adminTransactions').add({
                    userId: userId,
                    userEmail: userData.email,
                    adminId: currentUser.uid,
                    adminEmail: currentUser.email,
                    type: 'remove',
                    amount: amount,
                    previousCoins: currentCoins,
                    newCoins: newCoins,
                    reason: reason,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification(`Removed ${amount} coins from ${userData.email}`, "success");
                
                loadAllUsers();
                loadTransactions();
                loadStatistics();
                
            } catch (error) {
                console.error("Error removing coins:", error);
                showNotification("Error removing coins", "error");
            }
        }

        // Set coins for user
        async function setCoinsForUser(userId, amount, reason) {
            if (!isAdmin || !currentUser) {
                showNotification("Admin access required", "error");
                return;
            }
            
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (!userDoc.exists) {
                    showNotification("User not found", "error");
                    return;
                }
                
                const userData = userDoc.data();
                const currentCoins = userData.coins || 150;
                const newCoins = Math.max(0, amount);
                
                await db.collection('users').doc(userId).update({
                    coins: newCoins,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await db.collection('adminTransactions').add({
                    userId: userId,
                    userEmail: userData.email,
                    adminId: currentUser.uid,
                    adminEmail: currentUser.email,
                    type: 'set',
                    amount: amount,
                    previousCoins: currentCoins,
                    newCoins: newCoins,
                    reason: reason,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showNotification(`Set ${userData.email}'s coins to ${amount}`, "success");
                
                loadAllUsers();
                loadTransactions();
                loadStatistics();
                
            } catch (error) {
                console.error("Error setting coins:", error);
                showNotification("Error setting coins", "error");
            }
        }

        // Send admin message
        async function sendAdminMessage() {
            if (!isAdmin || !currentUser) {
                showNotification("Admin access required", "error");
                return;
            }
            
            const recipient = document.getElementById('messageRecipient').value;
            const title = document.getElementById('messageTitle').value.trim();
            const content = document.getElementById('messageContent').value.trim();
            const fileInput = document.getElementById('messageImage');
            const file = fileInput.files[0];
            
            if (!title || !content) {
                showNotification("Please fill in title and content", "error");
                return;
            }
            
            if (!recipient) {
                showNotification("Please select a recipient", "error");
                return;
            }
            
            let imageUrl = null;
            if (file) {
                try {
                    const storageRef = storage.ref();
                    const fileRef = storageRef.child(`admin-messages/${Date.now()}_${file.name}`);
                    await fileRef.put(file);
                    imageUrl = await fileRef.getDownloadURL();
                } catch (error) {
                    console.error("Error uploading image:", error);
                    showNotification("Error uploading image", "error");
                    return;
                }
            }
            
            const messageData = {
                title: title,
                content: content,
                imageUrl: imageUrl,
                senderId: currentUser.uid,
                senderEmail: currentUser.email,
                senderName: currentUser.displayName || currentUser.email.split('@')[0],
                recipients: recipient === 'all' ? 'all' : [recipient],
                isActive: true,
                readBy: [],
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                await db.collection('adminMessages').add(messageData);
                
                showNotification(`Message sent to ${recipient === 'all' ? 'all users' : recipient}`, "success");
                
                document.getElementById('messageTitle').value = '';
                document.getElementById('messageContent').value = '';
                fileInput.value = '';
                const preview = document.getElementById('messageImagePreview');
                preview.style.display = 'none';
                preview.src = '';
                
            } catch (error) {
                console.error("Error sending message:", error);
                showNotification("Error sending message", "error");
            }
        }

        // Initialize admin panel
        function initAdminPanel() {
            adminAccessBtn.addEventListener('click', () => {
                showSection(adminContainer);
                loadAllUsers();
                loadTransactions();
                loadStatistics();
            });
            
            document.getElementById('backFromAdmin')?.addEventListener('click', () => {
                showSection(dashboard);
            });
            
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    document.querySelectorAll('.admin-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.querySelectorAll('.admin-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });
            
            document.getElementById('addCoinsBtn')?.addEventListener('click', async () => {
                const userId = document.getElementById('coinUserSelect').value;
                const amount = parseInt(document.getElementById('coinAmount').value);
                const reason = document.getElementById('coinReason').value.trim();
                
                if (!userId) {
                    showNotification("Please select a user", "error");
                    return;
                }
                
                if (!amount || amount <= 0) {
                    showNotification("Please enter a valid amount", "error");
                    return;
                }
                
                await addCoinsToUser(userId, amount, reason || "Admin adjustment");
                
                document.getElementById('coinAmount').value = '';
                document.getElementById('coinReason').value = '';
            });
            
            document.getElementById('removeCoinsBtn')?.addEventListener('click', async () => {
                const userId = document.getElementById('coinUserSelect').value;
                const amount = parseInt(document.getElementById('coinAmount').value);
                const reason = document.getElementById('coinReason').value.trim();
                
                if (!userId) {
                    showNotification("Please select a user", "error");
                    return;
                }
                
                if (!amount || amount <= 0) {
                    showNotification("Please enter a valid amount", "error");
                    return;
                }
                
                await removeCoinsFromUser(userId, amount, reason || "Admin adjustment");
                
                document.getElementById('coinAmount').value = '';
                document.getElementById('coinReason').value = '';
            });
            
            document.getElementById('setCoinsBtn')?.addEventListener('click', async () => {
                const userId = document.getElementById('coinUserSelect').value;
                const amount = parseInt(document.getElementById('coinAmount').value);
                const reason = document.getElementById('coinReason').value.trim();
                
                if (!userId) {
                    showNotification("Please select a user", "error");
                    return;
                }
                
                if (!amount || amount < 0) {
                    showNotification("Please enter a valid amount", "error");
                    return;
                }
                
                await setCoinsForUser(userId, amount, reason || "Admin adjustment");
                
                document.getElementById('coinAmount').value = '';
                document.getElementById('coinReason').value = '';
            });
            
            document.getElementById('sendMessageBtn')?.addEventListener('click', () => {
                sendAdminMessage();
            });
            
            document.getElementById('messageImageUpload')?.addEventListener('click', () => {
                document.getElementById('messageImage').click();
            });
            
            document.getElementById('messageImage')?.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const preview = document.getElementById('messageImagePreview');
                        preview.src = event.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('adminUserSearch')?.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const userItems = document.querySelectorAll('.user-item');
                
                userItems.forEach(item => {
                    const email = item.querySelector('.user-details p').textContent.toLowerCase();
                    const name = item.querySelector('.user-details h4').textContent.toLowerCase();
                    
                    if (email.includes(searchTerm) || name.includes(searchTerm)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            initBubbles();
            
            // Remove the automatic login check delay
            // We'll let Firebase auth state listener handle it
            
            themeToggle.addEventListener('click', function() {
                const body = document.body;
                const icon = this.querySelector('i');
                
                if (body.classList.contains('light-mode')) {
                    body.classList.remove('light-mode');
                    body.classList.add('dark-mode');
                    icon.className = 'fas fa-moon';
                } else {
                    body.classList.remove('dark-mode');
                    body.classList.add('light-mode');
                    icon.className = 'fas fa-sun';
                }
                
                initBubbles();
            });
            
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    document.querySelectorAll('.auth-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.querySelectorAll('.auth-form').forEach(form => {
                        form.classList.remove('active');
                    });
                    document.getElementById(`${tabId}Form`).classList.add('active');
                });
            });
            
            document.getElementById('loginForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
                    .then(() => {
                        return auth.signInWithEmailAndPassword(email, password);
                    })
                    .then((userCredential) => {
                        currentUser = userCredential.user;
                        showNotification("Login successful!", "success");
                        authContainer.style.display = 'none';
                        showSection(dashboard);
                        updateUserInfo(currentUser);
                        loadPoems();
                        loadNovels();
                        loadUserContent();
                        loadUserLikes();
                        checkAdminMessages();
                        checkAdminStatus(currentUser);
                    })
                    .catch((error) => {
                        console.error("Login error:", error);
                        showNotification("Login failed: " + error.message, "error");
                    });
            });
            
            document.getElementById('signupForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const nickname = document.getElementById('signupNickname').value;
                
                auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
                    .then(() => {
                        return auth.createUserWithEmailAndPassword(email, password);
                    })
                    .then((userCredential) => {
                        return userCredential.user.updateProfile({
                            displayName: nickname
                        }).then(() => {
                            const isAdminUser = email === "admin@king.com";
                            return db.collection('users').doc(userCredential.user.uid).set({
                                name: name,
                                email: email,
                                nickname: nickname,
                                coins: isAdminUser ? 10000 : 150,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                                isAdmin: isAdminUser,
                                isBanned: false
                            }, { merge: true });
                        });
                    })
                    .then(() => {
                        currentUser = auth.currentUser;
                        const isAdminUser = email === "admin@king.com";
                        showNotification(`Account created successfully! You received ${isAdminUser ? '10,000' : '150'} coins.`, "success");
                        authContainer.style.display = 'none';
                        showSection(dashboard);
                        updateUserInfo(currentUser);
                        loadPoems();
                        loadNovels();
                        loadUserContent();
                        loadUserLikes();
                        checkAdminStatus(currentUser);
                    })
                    .catch((error) => {
                        console.error("Signup error:", error);
                        showNotification("Signup failed: " + error.message, "error");
                    });
            });
            
            poemSelection.addEventListener('click', () => {
                showSection(poemListContainer);
                loadPoems();
            });
            
            novelSelection.addEventListener('click', () => {
                showSection(novelListContainer);
                loadNovels();
            });
            
            document.getElementById('backFromPoemList')?.addEventListener('click', () => showSection(dashboard));
            document.getElementById('backFromNovelList')?.addEventListener('click', () => showSection(dashboard));
            document.getElementById('backFromPoemDetail')?.addEventListener('click', () => showSection(poemListContainer));
            document.getElementById('backFromNovelDetail')?.addEventListener('click', () => showSection(novelListContainer));
            document.getElementById('backFromUpload')?.addEventListener('click', () => {
                if (currentUploadType === 'poem') {
                    showSection(poemListContainer);
                } else {
                    showSection(novelListContainer);
                }
            });
            document.getElementById('backFromProfile')?.addEventListener('click', () => showSection(dashboard));
            
            floatingAddBtn.addEventListener('click', () => {
                if (poemListContainer.style.display === 'block') {
                    setupUpload('poem');
                } else if (novelListContainer.style.display === 'block') {
                    setupUpload('novel');
                } else if (profileContainer.style.display === 'block') {
                    setupUpload('poem');
                } else {
                    setupUpload('poem');
                }
            });
            
            document.getElementById('uploadArea').addEventListener('click', () => {
                document.getElementById('imageUpload').click();
            });
            
            document.getElementById('imageUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const preview = document.getElementById('imagePreview');
                        preview.src = event.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('submitUpload').addEventListener('click', function(e) {
                e.preventDefault();
                handleUpload();
            });
            
            document.getElementById('poemSearch')?.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const poemItems = document.querySelectorAll('.poem-item');
                
                poemItems.forEach(item => {
                    const title = item.querySelector('.item-title').textContent.toLowerCase();
                    const author = item.querySelector('.item-author').textContent.toLowerCase();
                    
                    if (title.includes(searchTerm) || author.includes(searchTerm)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
            
            document.getElementById('novelSearch')?.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const novelItems = document.querySelectorAll('.novel-item');
                
                novelItems.forEach(item => {
                    const title = item.querySelector('.item-title').textContent.toLowerCase();
                    const author = item.querySelector('.item-author').textContent.toLowerCase();
                    
                    if (title.includes(searchTerm) || author.includes(searchTerm)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
            
            document.getElementById('userAvatar')?.addEventListener('click', () => {
                showSection(profileContainer);
                loadUserContent();
            });
            
            document.getElementById('closeAdminMessage').addEventListener('click', () => {
                adminMessage.classList.remove('show');
            });
            
            document.getElementById('logoutBtn')?.addEventListener('click', logoutUser);
            document.getElementById('logoutBtnProfile')?.addEventListener('click', logoutUser);
            
            initAdminPanel();
            
            // Firebase auth state listener - handles login persistence
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    kingLogo.style.display = 'none';
                    authContainer.style.display = 'none';
                    showSection(dashboard);
                    updateUserInfo(user);
                    loadPoems();
                    loadNovels();
                    loadUserContent();
                    loadUserLikes();
                    checkAdminMessages();
                    
                    checkAdminStatus(user);
                } else {
                    currentUser = null;
                    isAdmin = false;
                    kingLogo.style.display = 'flex';
                    setTimeout(() => {
                        kingLogo.style.display = 'none';
                        authContainer.style.display = 'flex';
                    }, 2000);
                    showSection(null);
                    adminAccessBtn.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>